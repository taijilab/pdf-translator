<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF 翻译工具</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}?v=5">
</head>
<body>
    <div class="container">
        <header>
            <h1>📄 PDF 翻译工具</h1>
            <p class="subtitle">上传PDF文件，自动翻译并保持格式</p>
        </header>

        <div class="upload-section">
            <form id="translateForm" enctype="multipart/form-data">
                <!-- 文件上传 -->
                <div class="file-upload-area" id="dropArea">
                    <svg class="upload-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                    </svg>
                    <p class="upload-text">点击选择或拖拽PDF文件到此处</p>
                    <input type="file" id="fileInput" name="file" accept=".pdf" hidden>
                    <p class="file-info" id="fileInfo"></p>
                </div>

                <!-- 文件分析信息 -->
                <div class="file-analysis" id="fileAnalysis" style="display: none;">
                    <h3>📊 文件信息</h3>
                    <div class="analysis-grid">
                        <div class="analysis-item">
                            <span class="analysis-label">总页数:</span>
                            <span class="analysis-value" id="totalPages">-</span>
                        </div>
                        <div class="analysis-item">
                            <span class="analysis-label">字数:</span>
                            <span class="analysis-value" id="charCount">-</span>
                        </div>
                        <div class="analysis-item">
                            <span class="analysis-label">检测语言:</span>
                            <span class="analysis-value" id="detectedLang">-</span>
                        </div>
                        <div class="analysis-item">
                            <span class="analysis-label">预计时长:</span>
                            <span class="analysis-value" id="estimatedTime">-</span>
                        </div>
                    </div>
                </div>

                <!-- 输出格式选择 -->
                <div class="output-format-section">
                    <label for="outputFormat">输出格式</label>
                    <select id="outputFormat" name="output_format">
                        <option value="pdf">📄 PDF文件（保持原格式）</option>
                        <option value="text">📝 TXT文件（纯文本，更快）</option>
                    </select>
                    <p class="format-note">
                        💡 <strong>提示</strong>: TXT格式只提取文字并翻译，不保留PDF格式，速度更快。
                    </p>
                </div>

                <!-- API选择 -->
                <div class="api-selection">
                    <label for="apiType">翻译服务</label>
                    <select id="apiType" name="api_type">
                        <option value="google">Google Translate (免费)</option>
                        <option value="deepseek">DeepSeek API ($0.14/M tokens)</option>
                        <option value="kimi">Kimi 2.5 via OpenRouter ($1.2/M tokens)</option>
                        <option value="gpt">GPT-4 Turbo via OpenRouter ($2/M in)</option>
                        <option value="openrouter">OpenRouter (DeepSeek)</option>
                        <option value="zhipu">智谱AI API ($0.5/M tokens)</option>
                    </select>
                </div>

                <!-- API密钥输入（当选择非Google API时显示） -->
                <div class="api-key-section" id="apiKeySection" style="display: none;">
                    <label for="apiKey">API密钥 ⚠️</label>
                    <input type="password" id="apiKey" name="api_key" placeholder="请输入API密钥">
                    <p class="api-note">
                        💡 <strong>提示</strong>: 如果没有API密钥，请使用"Google翻译 (免费)"选项，无需API Key即可翻译！
                    </p>
                </div>


                <!-- 语言选择和并发设置（同一行） -->
                <div class="settings-row">
                    <div class="language-group">
                        <label for="sourceLang">源语言</label>
                        <select id="sourceLang" name="source_lang">
                            <option value="auto">🔍 自动检测</option>
                            <option value="en">🇺🇸 英语 (English)</option>
                            <option value="zh">🇨🇳 中文 (简体)</option>
                            <option value="ja">🇯🇵 日语 (日本語)</option>
                            <option value="ko">🇰🇷 韩语 (한국어)</option>
                            <option value="fr">🇫🇷 法语 (Français)</option>
                            <option value="de">🇩🇪 德语 (Deutsch)</option>
                            <option value="es">🇪🇸 西班牙语 (Español)</option>
                            <option value="ru">🇷🇺 俄语 (Русский)</option>
                            <option value="ar">🇸🇦 阿拉伯语 (العربية)</option>
                        </select>
                    </div>

                    <div class="swap-arrow">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3" />
                        </svg>
                    </div>

                    <div class="language-group">
                        <label for="targetLang">目标语言</label>
                        <select id="targetLang" name="target_lang">
                            <option value="zh" selected>🇨🇳 中文 (简体)</option>
                            <option value="en">🇺🇸 英语 (English)</option>
                            <option value="ja">🇯🇵 日语 (日本語)</option>
                            <option value="ko">🇰🇷 韩语 (한국어)</option>
                            <option value="fr">🇫🇷 法语 (Français)</option>
                            <option value="de">🇩🇪 德语 (Deutsch)</option>
                            <option value="es">🇪🇸 西班牙语 (Español)</option>
                            <option value="ru">🇷🇺 俄语 (Русский)</option>
                            <option value="ar">🇸🇦 阿拉伯语 (العربية)</option>
                        </select>
                    </div>

                    <div class="concurrency-group">
                        <label for="concurrency">并发数</label>
                        <input type="number" id="concurrency" name="concurrency" min="1" max="50" value="4" placeholder="4">
                        <span class="concurrency-hint">⚡</span>
                    </div>
                </div>

                <p class="settings-note">
                    💡 <strong>提示</strong>: 并发数越高速度越快，但可能触发API限制。建议：Google翻译使用2-4，付费API可用4-10。
                </p>

                <div class="button-group">
                    <button type="submit" class="btn-primary" id="translateBtn">
                        <span id="btnText">开始翻译</span>
                        <span id="btnLoader" class="loader" hidden></span>
                    </button>
                    <button type="button" class="btn-cancel" id="cancelBtn" hidden>
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" style="width: 16px; height: 16px; vertical-align: middle;">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                        取消翻译
                    </button>
                </div>
            </form>

            <!-- 进度显示 -->
            <div class="progress-section" id="progressSection" hidden>
                <div class="progress-header">
                    <h3>翻译进度</h3>
                    <span class="progress-percentage" id="progressPercentage">0%</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <p class="progress-text" id="progressText">正在准备...</p>

                <!-- 时间统计 -->
                <div class="time-stats" id="timeStats">
                    <div class="stat-item">
                        <span class="stat-label">⏱️ 已用时间:</span>
                        <span class="stat-value" id="elapsedTime">0秒</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">⏳ 预计剩余:</span>
                        <span class="stat-value" id="remainingTime">计算中...</span>
                    </div>
                </div>

                <!-- Token和费用统计 -->
                <div class="token-stats" id="tokenStats">
                    <div class="stat-item">
                        <span class="stat-label">输入Tokens:</span>
                        <span class="stat-value" id="inputTokens">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">输出Tokens:</span>
                        <span class="stat-value" id="outputTokens">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">预估费用:</span>
                        <span class="stat-value" id="estimatedCost">$0.0000</span>
                    </div>
                </div>

                <!-- 翻译过程窗口（左右对照显示原文和译文） -->
                <div class="translation-process" id="translationProcess">
                    <div class="process-header">
                        <span>🔄 翻译过程</span>
                    </div>
                    <div class="comparison-view">
                        <div class="comparison-header">
                            <div class="col-header original-header">📄 原文（输入给翻译API）</div>
                            <div class="col-header translated-header">✍️ 译文（翻译API返回）</div>
                        </div>
                        <div class="comparison-content" id="processContent">
                            <div class="empty-state">
                                <p>等待翻译...</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 翻译日志窗口（独立显示） -->
                <div class="translation-log" id="translationLog">
                    <div class="log-header">
                        <span>📋 翻译日志</span>
                        <button class="btn-copy-log" id="copyLogBtn" title="复制所有日志">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" style="width: 16px; height: 16px;">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                            </svg>
                            复制日志
                        </button>
                    </div>
                    <div class="log-content" id="logContent"></div>
                </div>

                <!-- 完成后的操作按钮 -->
                <div class="completion-actions" id="completionActions" hidden>
                    <div class="action-header">
                        <h3>🎉 翻译完成！</h3>
                    </div>
                    <div class="action-buttons">
                        <button class="btn-preview" id="previewBtn">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" style="width: 20px; height: 20px; vertical-align: middle;">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                            </svg>
                            预览翻译结果
                        </button>
                        <button class="btn-download" id="downloadBtn">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" style="width: 20px; height: 20px; vertical-align: middle;">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                            </svg>
                            下载翻译文件
                        </button>
                    </div>
                </div>
            </div>

            <!-- 文本预览模态框 -->
            <div class="preview-modal" id="previewModal" hidden>
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>📄 翻译结果预览</h3>
                        <button class="modal-close" id="modalClose">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="preview-toolbar">
                            <button class="btn-copy-preview" id="copyPreviewBtn">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" style="width: 16px; height: 16px;">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                                </svg>
                                复制全部
                            </button>
                            <span class="preview-info" id="previewInfo"></span>
                        </div>
                        <pre class="preview-text" id="previewText">加载中...</pre>
                    </div>
                </div>
            </div>

            <div class="message" id="message"></div>
        </div>

        <footer>
            <p>支持的文件大小: 最大 50MB | 翻译服务: Google/DeepSeek/智谱AI</p>
        </footer>
    </div>

    <script src="{{ url_for('static', filename='js/app.js') }}?v=7"></script>
</body>
</html>
